
# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

| Опции | KONG Gateway | Nginx | Tyk | Apache APISIX | AWS API Gateway | Yandex API Gateway |
| --- | --- | --- | --- | --- | --- | --- |
| Маршрутизация запросов | + | + | + | + | + | + |
| Проверка аутентификации | + | + | + | + | + | + |
| Терминация HTTPS | + | + | + | + | + | + |
| Размещение | Облако + self-hosted | self-hosted | Облако + self-hosted | self-hosted | Облако | Облако |
| Цена | Платный (+ триал на 30 дней) | Бесплатный | Платный (+ триал на 30 дней) | Бесплатный | Платный (по количеству вызовов) | Платный (по количеству вызовов) |

***

Выбор конкретного решения зависит от задач и бюджета.

 - Производительность зависит от многих факторов, поэтому сравнивать решения в идеальной среде будет не совсем корректно.

 - Масштабируемость проще у облачных шлюзов, поскольку это уровень ответственности провайдера.

 - Простота конфигурации остается за платными и облачными решениями — они обеспечивают нужный функционал «из коробки» и предлагают простой интерфейс для управления.

 - Конечная стоимость неоднозначный параметр, поскольку включает в себя не только стоимость лицензии продукта, но и стоимость размещения и стоимость обслуживания. Бесплатным self-hosted решениям требуются собственные вычислительные мощности для размещения и персонал для обслуживания.

При ограниченном бюджете можно выбрать **nginx** или **apache apisix** и дополнительно сконфигурировать их для своих нужд. При наличии инфраструктуры у облачного провайдера (AWS, Yandex Cloud) проще использовать **решение провайдера**, делегировав ему вопросы интеграции, масштабирования и обслуживания.

Для домашней лаборатории я бы выбрал **nginx**, для крупных проектов выбор зависит от размещения инфраструктуры: в случае self-hosted можно использовать **KONG Gateway**, в случае размещения у облачных провайдеров – **шлюзы облачных провайдеров**


## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

***

| Опции | Apache Kafka | Apache ActiveMQ | RabbitMQ | NATS | IBM MQ | Amazon MQ |
| --- | --- | --- | --- | --- | --- | --- |
| Поддержка кластеризации | + | кластеризация доступна в ActiveMQ Artemis | + | + | + | + |
| Хранение сообщений на диске в процессе доставки | + | + | + | - | + | + |
| Высокая скорость работы | ++ | + | + | ++ | + | + |
| Поддержка различных форматов сообщений | + | + | + | + | + | + |
| Разделение прав доступа | + разделение по ролям | + разделение по ролям | + контроль доступа и ресурсов | + независимые пространства имен | + разделение по ролям | + разделение по ролям |
| Простота эксплуатации | - | + | + | ++ | - | - |

Облачный брокер сообщений Amazon MQ имеет смысл использовать, если инфрастуктура развернута в облаке AWS.

IBM MQ - платное решение enterprise-класса, для небольших компаний и домашних лабораторий избыточно.

NATS - производительный и простой в эксплуатации брокер сообщений без промежуточного хранения.

Apache ActiveMQ Artemis - в целом, неплохой инструмент со средним набором функций.

Apache Kafka рассчитан на большие объемы данных, позволяет перечитывать сообщения и обеспечивает высокую производительность в ущерб возможностям маршрутизации. Для обеспечения лучшей безопасности необходимо использовать коммерческую версию Apache Kafka Confluent.

RabbitMQ менее производительный, чем Apache Kafka, удаляет сообщения после отправки, но позволяет организовать более гибкую маршрутизацию сообщений.

Если не требуется постоянное хранение сообщений, и при этом важна скорость развертывания и простота настройки, я бы рекомендовал использовать **RabbitMQ**
